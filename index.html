<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scan QR Wagon</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f3f4f6;
}

h1 {
    text-align: center;
}

button {
    padding: 12px 20px;
    font-size: 16px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

button:hover {
    background: #1e40af;
}

#reader {
    width: 100%;
    max-width: 400px;
    margin: 20px auto;
}

#result {
    margin-top: 20px;
    padding: 15px;
    background: white;
    border-radius: 6px;
    word-break: break-word;
}

.hidden {
    display: none;
}
</style>
</head>

<body>

<h1>Scanner QR Wagon</h1>

<div style="text-align:center;">
    <button onclick="startScanner()">Scanner un QR Code</button>
</div>

<div id="reader" class="hidden"></div>

<div id="result"></div>

<script>

let html5QrCode;

function startScanner() {

    document.getElementById("reader").classList.remove("hidden");
    document.getElementById("result").innerHTML = "";

    html5QrCode = new Html5Qrcode("reader");

    html5QrCode.start(
        { facingMode: "environment" },
        {
            fps: 10,
            qrbox: 250
        },
        (decodedText) => {
            showResult(decodedText);
        },
        (errorMessage) => {
            // erreurs ignorées volontairement
        }
    ).catch(err => {
        alert("Erreur caméra : " + err);
    });
}

function showResult(text) {

    document.getElementById("result").innerHTML =
        "<strong>QR détecté :</strong><br>" + text;

    if (html5QrCode) {
        html5QrCode.stop().then(() => {
            document.getElementById("reader").classList.add("hidden");
        });
    }
}

</script>

</body>
</html>
